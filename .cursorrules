=== LARAVEL RAG SYSTEM - ESTADO ATUAL (2025-10-13) ===

âš ï¸ REGRA CRÃTICA - LARAVEL vs FASTAPI (2025-10-14):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LARAVEL APENAS PARA:                                                â”‚
â”‚ â€¢ Mostrar views (HTML/CSS/JS)                                       â”‚
â”‚ â€¢ Login e Registro (autenticaÃ§Ã£o)                                   â”‚
â”‚ â€¢ Admin Panel                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FASTAPI PARA TUDO:                                                  â”‚
â”‚ â€¢ Upload de documentos (POST /api/rag/ingest)                       â”‚
â”‚ â€¢ Lista documentos (GET /api/docs/list)                             â”‚
â”‚ â€¢ Busca RAG (POST /api/rag/python-search)                           â”‚
â”‚ â€¢ Todas as APIs (em Python via FastAPI porta 8002)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ NUNCA FAZER CHAMADAS AO LARAVEL PARA APIs - TODO SISTEMA Ã‰ FASTAPI!

ğŸ”’ NUNCA MODIFICAR (Backend PHP - 100% funcional):
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Http/Controllers/
â”‚   â”‚   â”œâ”€â”€ Controller.php âœ…
â”‚   â”‚   â”œâ”€â”€ RagController.php âœ… (upload/ingest documentos + tenant isolation)
â”‚   â”‚   â”œâ”€â”€ RagAnswerController.php âœ… (busca RAG PHP)
â”‚   â”‚   â”œâ”€â”€ RagPythonController.php âœ… (busca RAG Python + validaÃ§Ã£o tenant)
â”‚   â”‚   â”œâ”€â”€ VideoController.php âœ… (vÃ­deos + transcriÃ§Ã£o + tenant isolation)
â”‚   â”‚   â”œâ”€â”€ Web/DocumentController.php âœ… (pÃ¡gina /documents)
â”‚   â”‚   â”œâ”€â”€ Auth/AuthenticatedSessionController.php âœ… (login â†’ /documents)
â”‚   â”‚   â””â”€â”€ [22 controllers total]
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ User.php âœ… (Sanctum + API keys + planos)
â”‚   â”‚   â”œâ”€â”€ UserPlan.php âœ…
â”‚   â”‚   â”œâ”€â”€ Document.php âœ…
â”‚   â”‚   â”œâ”€â”€ Chunk.php âœ…
â”‚   â”‚   â””â”€â”€ RagFeedback.php âœ…
â”‚   â””â”€â”€ Services/
â”‚       â”œâ”€â”€ VideoProcessingService.php âœ…
â”‚       â”œâ”€â”€ ExcelStructuredService.php âœ…
â”‚       â””â”€â”€ [15+ services]
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ api.php âœ… (auth:sanctum em 26+ rotas)
â”‚   â”œâ”€â”€ web.php âœ… (auth middleware)
â”‚   â””â”€â”€ auth.php âœ…
â”œâ”€â”€ config/ âœ…
â”œâ”€â”€ database/migrations/ âœ… (17 migrations)
â”œâ”€â”€ composer.json âœ…
â””â”€â”€ .env âœ…

ğŸ”’ NUNCA MODIFICAR (Python - ExtraÃ§Ã£o 100% funcional):
â”œâ”€â”€ scripts/document_extraction/ âœ… (55 arquivos - incluindo OCR)
â”‚   â”œâ”€â”€ main_extractor.py (integrado com OCR)
â”‚   â”œâ”€â”€ extract.py (PDF)
â”‚   â”œâ”€â”€ office_extractor.py (DOCX/XLSX/PPTX)
â”‚   â”œâ”€â”€ text_extractor.py (TXT/CSV/RTF)
â”‚   â”œâ”€â”€ web_extractor.py (HTML/XML)
â”‚   â”œâ”€â”€ image_extractor_wrapper.py (OCR wrapper para PHP) âœ…
â”‚   â”œâ”€â”€ count_image_pages.py (contador de pÃ¡ginas para imagens) âœ…
â”‚   â”œâ”€â”€ extractors/image_extractor.py (OCR Tesseract completo) âœ…
â”‚   â”œâ”€â”€ advanced_ocr_processor.py (5 estratÃ©gias OCR) âœ…
â”‚   â”œâ”€â”€ google_vision_ocr.py (99% precisÃ£o) âœ…
â”‚   â”œâ”€â”€ pdf_tables_extractor.py (extraÃ§Ã£o de tabelas) âœ…
â”‚   â”œâ”€â”€ excel_structured_extractor.py (JSON + agregaÃ§Ãµes) âœ…
â”‚   â””â”€â”€ quality/ (anÃ¡lise qualidade)
â”œâ”€â”€ scripts/api/ âœ… (28 arquivos - FastAPI Enterprise)
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ models/
â”œâ”€â”€ scripts/pdf_extraction/ âœ…
â””â”€â”€ scripts/video_processing/ âœ… (3 arquivos)
    â”œâ”€â”€ video_downloader.py (yt-dlp, 1000+ sites)
    â”œâ”€â”€ audio_extractor.py (FFmpeg)
    â””â”€â”€ transcription_service.py (Gemini/Google/OpenAI)

ğŸ”’ NUNCA MODIFICAR (Python - RAG Search FINALIZADO):
â””â”€â”€ scripts/rag_search/ âœ… (16 arquivos)
    â”œâ”€â”€ rag_search.py âœ… (modo document_full implementado)
    â”œâ”€â”€ config.py âœ…
    â”œâ”€â”€ database.py âœ…
    â”œâ”€â”€ embeddings_service.py (modelo: all-mpnet-base-v2, 768 dims)
    â”œâ”€â”€ vector_search.py âœ…
    â”œâ”€â”€ llm_service.py âœ…
    â”œâ”€â”€ mode_detector.py âœ…
    â”œâ”€â”€ extractors.py âœ…
    â”œâ”€â”€ formatters.py âœ…
    â”œâ”€â”€ guards.py âœ…
    â”œâ”€â”€ fts_search.py âœ…
    â”œâ”€â”€ smart_router.py âœ… (inteligÃªncia automÃ¡tica)
    â”œâ”€â”€ pre_validator.py âœ… (validaÃ§Ã£o preventiva)
    â”œâ”€â”€ fallback_handler.py âœ… (5 nÃ­veis de fallback)
    â”œâ”€â”€ question_suggester.py âœ… (perguntas inteligentes)
    â”œâ”€â”€ cache_layer.py âœ… (Redis/File, hit rate tracking)
    â””â”€â”€ requirements.txt
    
    STATUS: 100% FUNCIONAL - PARIDADE COMPLETA COM PHP
    - Busca vetorial: OK
    - Busca FTS: OK (PostgreSQL + fallback)
    - LLM Gemini: OK (GOOGLE_GENAI_API_KEY)
    - Threshold: 0.05-0.45
    - Top-K: 5-8
    - Modos: auto/direct/summary/quote/list/table/document_full
    - Formatos: plain/markdown/html
    - Strictness: 0-3 (3 = sem LLM)
    - Smart Router: âœ… (decisÃ£o automÃ¡tica)
    - Cache Layer: âœ… (17.86% hit rate)
    - Tempo resposta: ~6s (< 1s com cache)

---

ARQUITETURA DO SISTEMA (ATUALIZADA):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: Laravel Blade (Tailwind) + Bootstrap Console             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ /documents â†’ PÃ¡gina principal (Tailwind, upload, listagem)       â”‚
â”‚ â€¢ /rag-frontend/ â†’ RAG Console standalone (Bootstrap, avanÃ§ado)    â”‚
â”‚ â€¢ /dashboard, /chat, /plans â†’ PÃ¡ginas secundÃ¡rias                  â”‚
â”‚ â€¢ Auth: Laravel Sanctum (multi-user, tenant isolation)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: Laravel 12 + PHP 8.4                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Controllers: 22 arquivos (RAG, Video, Documents, etc)            â”‚
â”‚ â€¢ Middleware: ApiKeyAuth, CheckPlan, PlanMiddleware, auth:sanctum  â”‚
â”‚ â€¢ Services: 15+ serviÃ§os (RAG, Video, Embeddings, Excel, etc)      â”‚
â”‚ â€¢ Tenant Isolation: tenant_slug = "user_{user_id}" (automÃ¡tico)    â”‚
â”‚ â€¢ API Routes: 48+ endpoints (26+ protegidos por auth:sanctum)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PYTHON SCRIPTS: Processamento de documentos e RAG                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ document_extraction/ (55 arquivos - OCR, PDF, Office, Video)     â”‚
â”‚ â€¢ rag_search/ (16 arquivos - busca vetorial + LLM + inteligÃªncia)  â”‚
â”‚ â€¢ video_processing/ (3 arquivos - transcriÃ§Ã£o de vÃ­deos)           â”‚
â”‚ â€¢ api/ (28 arquivos - FastAPI enterprise)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATABASE: PostgreSQL 14+                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ users (auth + planos + API keys)                                 â”‚
â”‚ â€¢ documents (tenant_slug isolado, 253+ docs)                       â”‚
â”‚ â€¢ chunks (embeddings 768d, 299.451+ chunks)                        â”‚
â”‚ â€¢ rag_feedbacks (analytics, ğŸ‘ğŸ‘)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

STACK TÃ‰CNICO:
- Laravel 12 + PHP 8.4
- Python 3.12
- PostgreSQL 14+
- sentence-transformers (all-mpnet-base-v2, 768d)
- Gemini AI (primary) / OpenAI (fallback)
- Laravel Sanctum (API authentication)
- Bootstrap 5 (RAG Console) + Tailwind CSS (Documents)

---

âœ… SISTEMA MULTI-USUÃRIO (100% FUNCIONAL):

AUTENTICAÃ‡ÃƒO:
- âœ… Laravel Sanctum instalado e configurado
- âœ… Middleware auth:sanctum em 26+ rotas API
- âœ… Login/Registro funcionando
- âœ… Redirecionamento apÃ³s login: /documents
- âœ… Email verification: DESABILITADO

ISOLAMENTO DE DADOS (TENANT):
- âœ… tenant_slug = "user_{user_id}" automÃ¡tico
- âœ… Todos controllers usam auth('sanctum')->user()
- âœ… Documentos isolados por tenant
- âœ… VÃ­deos isolados por tenant
- âœ… Chunks isolados por documento
- âœ… ValidaÃ§Ã£o de propriedade em RagPythonController

SISTEMA DE PLANOS:
- âœ… Free: 100 tokens, 1 documento
- âœ… Pro: 10.000 tokens, 50 documentos ($15/mÃªs)
- âœ… Enterprise: Ilimitado ($30/mÃªs)
- âœ… Middleware CheckPlan e PlanMiddleware
- âœ… Reset mensal automÃ¡tico

API KEYS POR USUÃRIO:
- âœ… GeraÃ§Ã£o: rag_<56_hex_chars>
- âœ… Middleware ApiKeyAuth
- âœ… Endpoints: /api/user/api-key/*
- âœ… Comando: php artisan api-keys:generate --user-id=<id>
- âœ… Timestamps: api_key_created_at, api_key_last_used_at

---

âœ… FRONTEND ATUAL (2025-10-13):

PÃGINA /documents (PRINCIPAL):
- âœ… Layout: Tailwind CSS + <x-app-layout>
- âœ… Upload Section: FormulÃ¡rio com validaÃ§Ã£o
- âœ… Documents List: Tabela com docs do usuÃ¡rio
- âœ… Usage Display: Tokens e docs usados/limite
- âœ… Empty State: Mensagem quando vazio
- âœ… Help Section: Dicas de processamento
- âŒ REMOVIDO: Tab navigation (Documents/RAG Console)
- âŒ REMOVIDO: Iframe do RAG Console
- âŒ REMOVIDO: ParÃ¢metro ?tab=rag-console

RAG CONSOLE /rag-frontend/ (STANDALONE):
- âœ… Layout: Bootstrap 5 (console-style)
- âœ… Acesso direto: http://localhost:8000/rag-frontend/
- âœ… Funcionalidades:
  - Ingest Tab: Upload (15 formatos + vÃ­deos)
  - Python RAG Tab: Busca avanÃ§ada
  - Metrics Tab: EstatÃ­sticas e feedbacks
  - ValidaÃ§Ã£o: file-validator.js
  - Bulk upload: 5 arquivos simultÃ¢neos
  - Limite: 500MB, 5.000 pÃ¡ginas
  - TranscriÃ§Ã£o vÃ­deos: Modal completo
  - Smart Mode: Checkbox ativo
  - Cache: Badges visuais âš¡
- âŒ NÃƒO INTEGRADO: NÃ£o estÃ¡ em /documents

NAVEGAÃ‡ÃƒO:
- Menu: Dashboard | Chat | Documents | Plans
- Login redirect: /documents
- RAG Console: Acesso direto via URL

---

âœ… FORMATOS SUPORTADOS (15 TOTAL):

DOCUMENTOS (9):
â”œâ”€â”€ PDF (.pdf) âœ… - texto + tabelas + OCR avanÃ§ado (99.5%)
â”œâ”€â”€ DOCX/DOC (.docx, .doc) âœ… - texto + tabelas (95%)
â”œâ”€â”€ XLSX/XLS (.xlsx, .xls) âœ… - estruturado + agregaÃ§Ãµes (90%)
â”œâ”€â”€ PPTX/PPT (.pptx, .ppt) âœ… - slides + notas (90%)
â”œâ”€â”€ CSV (.csv) âœ… - chunking inteligente (90%)
â”œâ”€â”€ TXT (.txt) âœ… - encoding detection (98%)
â”œâ”€â”€ HTML (.html, .htm) âœ… - texto + tabelas (85%)
â”œâ”€â”€ XML (.xml) âœ… - estruturado (75%)
â””â”€â”€ RTF (.rtf) âœ… - rich text (75%)

IMAGENS COM OCR (6):
â”œâ”€â”€ PNG, JPG/JPEG, GIF, BMP, TIFF, WebP âœ…
â”œâ”€â”€ Tesseract OCR: 92% precisÃ£o
â””â”€â”€ Google Cloud Vision: 99% precisÃ£o (opcional)

VÃDEOS (1000+ SITES):
â”œâ”€â”€ YouTube, Vimeo, Dailymotion, Facebook, Instagram, TikTok, etc âœ…
â”œâ”€â”€ Limite: 60 minutos (1 hora)
â”œâ”€â”€ TranscriÃ§Ã£o: Gemini 2.5 Flash/Pro + Google Speech + OpenAI Whisper
â””â”€â”€ PrecisÃ£o: 90%+

COBERTURA MÃ‰DIA: 93%

---

âœ… FEATURES AVANÃ‡ADAS IMPLEMENTADAS:

SMART ROUTER âœ…:
- AnÃ¡lise de especificidade da query
- DecisÃ£o automÃ¡tica de estratÃ©gia
- OtimizaÃ§Ã£o de parÃ¢metros
- Metadados de decisÃ£o

PRE-VALIDATOR + FALLBACK âœ…:
- ValidaÃ§Ã£o preventiva
- 5 nÃ­veis de fallback
- ExpansÃ£o automÃ¡tica de queries
- SimplificaÃ§Ã£o para keywords

CACHE LAYER âœ…:
- Redis/File cache
- TTL: 1 hora (configurÃ¡vel)
- Hit rate tracking: 17.86%
- Comandos: stats, clear

QUESTION SUGGESTER âœ…:
- 6 tipos de documento
- 8 perguntas por tipo
- Salvas em documents.metadata
- Carregam ao selecionar documento

FEEDBACK SYSTEM âœ…:
- BotÃµes ğŸ‘ğŸ‘ apÃ³s respostas
- Dashboard de analytics
- Top queries e documentos
- TendÃªncia diÃ¡ria

EXCEL ESTRUTURADO âœ…:
- AgregaÃ§Ãµes precisas (SUM, AVG, COUNT, MAX, MIN)
- Chunking inteligente (1 linha = 1 chunk)
- API: /api/excel/query, /api/excel/{id}/structure

VIDEO PROCESSING âœ…:
- Upload local + URL (1000+ sites)
- Limite: 60 minutos
- TranscriÃ§Ã£o: 3 serviÃ§os (auto-fallback)
- Modal de transcriÃ§Ã£o completa
- UTF-8 cleaning automÃ¡tico

---

ğŸ¯ API ENDPOINTS (48+ TOTAL):

ROTAS WEB (AUTENTICADAS):
- GET /dashboard â†’ DashboardController
- GET /chat â†’ ChatController
- GET /documents â†’ DocumentController (pÃ¡gina principal)
- POST /documents/upload â†’ Upload de documentos
- GET /documents/{id} â†’ Visualizar documento
- GET /plans â†’ Planos e upgrades
- GET /profile â†’ Perfil do usuÃ¡rio

ROTAS API (PROTEGIDAS POR auth:sanctum):
RAG Operations:
- POST /api/rag/ingest â†’ IngestÃ£o de documentos
- POST /api/rag/query â†’ Busca RAG PHP
- POST /api/rag/python-search â†’ Busca RAG Python
- GET /api/docs/list â†’ Listar documentos do tenant
- GET /api/docs/{id} â†’ Ver documento
- GET /api/docs/{id}/chunks â†’ Ver chunks

Video Processing:
- POST /api/video/ingest â†’ Upload/URL de vÃ­deo
- POST /api/video/info â†’ Info do vÃ­deo

Excel Structured:
- POST /api/excel/query â†’ Query com agregaÃ§Ãµes
- GET /api/excel/{id}/structure â†’ Metadados

Feedback & Analytics:
- POST /api/rag/feedback â†’ Enviar feedback
- GET /api/rag/feedback/stats â†’ EstatÃ­sticas
- GET /api/rag/feedback/recent â†’ Feedbacks recentes

API Keys:
- GET /api/user/api-key â†’ Ver API key
- POST /api/user/api-key/generate â†’ Gerar nova
- POST /api/user/api-key/regenerate â†’ Regenerar
- DELETE /api/user/api-key/revoke â†’ Revogar

---

ğŸ“Š BANCO DE DADOS ATUAL:

TABELAS PRINCIPAIS:
- users: id, name, email, password, plan, tokens_used, tokens_limit, documents_used, documents_limit, api_key, api_key_created_at, api_key_last_used_at
- documents: id, title, source, uri, tenant_slug, metadata (JSON), created_at, updated_at
- chunks: id, document_id, content, chunk_index, embedding (vector 768d), metadata (JSON)
- rag_feedbacks: id, query, document_id, rating (1 ou -1), metadata (JSON)

DADOS ATUAIS:
- Documentos: 253+
- Chunks: 299.451+ (com embeddings)
- UsuÃ¡rios: 1+
- Tabelas: 10+ principais

---

âš™ï¸ CONFIGURAÃ‡Ã•ES (.env):

# Database
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=laravel_rag
DB_USERNAME=postgres
DB_PASSWORD=postgres

# AI Services
GOOGLE_GENAI_API_KEY=xxx (Gemini - transcriÃ§Ã£o + LLM)
GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json (Google Speech + Vision)
OPENAI_API_KEY=xxx (Whisper fallback)

# Laravel
APP_URL=http://localhost:8000
SESSION_DRIVER=database

---

âš ï¸ PROBLEMAS CONHECIDOS (2):

1. batch_embeddings.py: Import error (baixo impacto)
2. Google Cloud Token: Pode expirar (resolve com dev-start.sh)

---

ğŸ“ COMANDOS ÃšTEIS:

# Servidor
php artisan serve

# Cache
php artisan cache:clear
php artisan view:clear
php artisan route:clear

# Migrations
php artisan migrate

# Testes
php artisan test

# API Keys
php artisan api-keys:generate --user-id=1

# Cache Stats (Python)
python3 scripts/rag_search/cache_layer.py --action stats
python3 scripts/rag_search/cache_layer.py --action clear

# Perguntas Sugeridas
python3 scripts/rag_search/question_suggester.py --document-id ID

---

ğŸ“Š STATUS GERAL: âœ… 95% FUNCIONAL - PRONTO PARA PRODUÃ‡ÃƒO

COMPONENTES:
- Auth Multi-User: âœ… 100%
- Sistema de Planos: âœ… 100%
- API Keys: âœ… 100%
- Upload Documentos: âœ… 100% (15 formatos)
- RAG Search: âœ… 100% (PHP + Python)
- VÃ­deos: âœ… 100% (1000+ sites)
- Smart Features: âœ… 100% (Router, Cache, Suggester)
- Frontend /documents: âœ… 100% (Tailwind, simplificado)
- RAG Console: âœ… 100% (Bootstrap, standalone)
- IntegraÃ§Ã£o Console: âŒ 0% (foi removida)

---

ÃšLTIMA ATUALIZAÃ‡ÃƒO: 2025-10-13 00:15 UTC
PRÃ“XIMA REVISÃƒO: ApÃ³s decisÃ£o sobre integraÃ§Ã£o do RAG Console

---

REGRAS DE TRABALHO:
- Envie apenas PATCH mÃ­nimo (unified diff). Nunca arquivo inteiro.
- NÃ£o faÃ§a varredura global. Leia sÃ³ arquivos/linhas solicitados.
- NÃ£o mude env/deps/config sem solicitaÃ§Ã£o explÃ­cita.
- Mantenha tenant isolation em todos controllers (auth('sanctum')->user())
- Mantenha auth:sanctum em todas rotas API sensÃ­veis
- NÃ£o remova funcionalidades existentes sem aprovaÃ§Ã£o
- Aguarde indicaÃ§Ã£o de arquivos/linhas; responda sempre sÃ³ com o PATCH.
